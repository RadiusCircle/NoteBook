# 应急响应_20221110

## Windows入侵排查

### 信息收集

systeminfo

环境变量

### 网络及进程

msinfo32

进程查看-tasklist

该工具显示在本地或远程机器上当前运行的进程列表

进程查看-wmic

```
wmic process get * /value
```

网络查看-netstat

显示协议统计信息和当前TCP/IP网络连接

| 参数 | 说明                       |
| ---- | -------------------------- |
| -a   | 显示所有连接和侦听端口     |
| -n   | 以数字形式显示地址和端口号 |
| -o   |                            |

网络+进程关联分析

进程id

资源监视器

进程处置

使用任务管理器

taskkill

终止进程名为cmd.exe的进程

## 可疑用户

用户排查-net

检查当前系统中的用户

```
net user
```

查看指定用户的详细情况

```
net user ""
```

用户排查-本地用户和组

win+r —> compmgmt.msc

用户排查-wmic

注册表取证

在很多情况下，

无线取证：通过注册表给出的信息，可以得到

文档取证：RecentDocs键可以通过文件扩展

URL取证：当用户在

IP地址取证：跟踪用户接口的IP地址，我们可以找到分配给接口的IP地址、子网掩码和DHCP服务器租用IP的事件

USB存储设备取证：



注册表启动项

特定用户登陆时启动：在以下键中，键值将在特定用户登陆时运行



系统开机启动项



RunOnce启动：如果攻击者只是希望软件在启动时运行一次，则可以再次设置子键



脚本启动项

攻击者可以通过蛇者系统启动或者用户登录项，实现可执行程序

任务计划程序

可以使用任务计划程序来创建和管理计算机将在所指定的时间自动执行的常见任务

【管理工具】 —> 【任务计划程序】

【cmd】 —> 【schtasks /query】

系统服务

在红队的攻击手段中，需要反弹shell或者打到可持续的目的时，会使用一些方式将payload注册到windows服务中

【win+R】

## Windows入侵排查工具

Autoruns

ProcessMonitor

进程动作抓取：在一些病毒中，常常会寻求访问一些敏感文件、注册表，创建模块等一些异常行为，所以我们可以通过辅助监控软件

ProcessExplorer

火绒剑

包括进程、启动项

PowerTool

有些病毒

D盾

PCHunter

Windows系统信息查看软件

## Linux入侵排查

### 网络及进程排查

netstat

输出网络连接、路由表、接口统计、伪装连接和组播成员

| 参数 | 说明                   |
| ---- | ---------------------- |
| -a   | 显示所有连线中的socket |
| -t   | 显示                   |
|      |                        |

lsof

列出打开的文件

查看网络连接

lsof -i

筛选指定端口的网络连接

lsof -i:22

筛选指定

top

显示系统当中的进程状态

ps

返回当前进程的快照

lsof

列出打开的文件

查看进程打开的文件

```
lsof -p <pid>
```

恶意进程处置

定位恶意进程ID（PID）

### 排查可疑用户

用户信息文件

/etc/passwd

影子文件

/etc/shadow

影子文件，记录账户密码信息等内容

sudo配置文件

/etc/sudoers

sudo配置文件，规定那些用户（组）可以使用sudo命令提权

w

查看当前登录的用户及其正在执行的命令

### 特殊文件排查

ssh key



保存这远程主机的公钥，远程主机可以无密码登录



每个用户在各自家目录下存储的公钥文件



每登录一台主机ssh就会把对方的公钥记录下来，下次连接时进行对比，以防止网络劫持

SUID&SGID

Linux下文件的权限类型包括读、写、执行，对应r、w、x。Linux下权限粒度有所有者、所在组、其他组三种。通常一个文件只能归属一个所有者和所在组，如果其他用户

文件时间

Linux中，文件和文件夹都有3个时间，可以使用【stat】命令查看每个问价或文件夹的时间属性

| 时间        | 描述 |
| ----------- | ---- |
| Access Time |      |
| Modift Time |      |
| Change Time |      |

命令排查

检查系统命令是否被劫持

查找文件位置



检查文件内容或MD5值



### 持久化操作排查

服务排查

在以前的Linux发行版本中，使用service命令管理各类服务，对应服务的管理脚本位于

服务是否开机自启可以通过【chkconfig】命令检查



命令执行结果中的【0~6】



在新的Linux发行版本中，使用systemctl命令管理各类服务，对应服务的配置脚本位于/etc/systemd/system路径或/user/lib/systemd/system路径下。

systemctl

启动脚本排查

在Linux中，启动脚本同样可以配置特定程序或脚本的开机自启，对应配置文件为：

```
/etc/rc.local
/etc/rc.d/rc/local
/etc/rc*.d/*
```

计划任务排查

Linux中的计划任务对应服务【crond】、命令【crontab】。计划任务的存储路径为：

```

```

Linux查杀工具

河马

河马是一款多平台的

GScan

